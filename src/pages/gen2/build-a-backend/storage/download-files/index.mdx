export const meta = {
  title: 'Download files',
  description: 'Download files using Amplify Storage'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };
}

<BlockSwitcher>
<Block name="Storage Image UI Component">
You can easily display images on your app by using the cloud-connected Storage Image UI component. This component fetches images securely from your storage resource and displays it on the web page.
</Block>
<Block name="Amplify Console">
You can download files on-demand from the Amplify Console
</Block>
</BlockSwitcher>

#### API Usage
To further customize your in-app experience, you can use the getURL or downloadData API from the Amplify Library for Storage.

<BlockSwitcher>
<Block name="getURL">
Get a presigned URL of a stored file and expiration of URL
</Block>
<Block name="downloadData">
Download a file to in-memory buffer.

```javascript
import { downloadData } from 'aws-amplify/storage';

// Downloads file content to memory
const { body, eTag } = await downloadData({
  path: "/album/2024/1.jpg",
  options: {
    onProgress: (event) => {
      console.log(event.transferredBytes);
    } // optional progress callback
    bytesRange: {
      start: 1024,
      end: 2048
    } // optional bytes range parameter to download a part of the file, the 2nd MB of the file in this example
  }
}).result;
```
### Get the text value of downloaded File

You can consume the value of file in any of the three formats: `blob`, `json`, or `text`. You can call the respective method on the `body` property to consume the set data in the respective format.

```javascript
import { downloadData } from 'aws-amplify/storage';

try {
  const downloadResult = await downloadData({ 
    path: "/album/2024/1.jpg" 
  }).result;
  const text = await downloadResult.body.text();
  // Alternatively, you can use `downloadResult.body.blob()`
  // or `downloadResult.body.json()` get read body in Blob or JSON format.
  console.log('Succeed: ', text);
} catch (error) {
  console.log('Error : ', error);
}
```
Transfer Acceleration
//TODO

Monitor download progress

```javascript
import { downloadData } from 'aws-amplify/storage';

// Download a file from s3 bucket
const { body, eTag } = await downloadData(
  {
    path: "/album/2024/1.jpg",
    options: {
      onProgress: (progress) {
        console.log(`Download progress: ${(progress.transferredBytes/progress.totalBytes) * 100}%`);
      }
    }
  }
).result;
```

Cancel download

```javascript
import { downloadData, isCancelError } from 'aws-amplify/storage';

const downloadTask = downloadData({ path: "/album/2024/1.jpg" });
downloadTask.cancel();
try {
  await downloadTask.result;
} catch (error) {
  if (isCancelError(error)) {
    // Handle error thrown by task cancellation.
  }
}
```

</Block>
</BlockSwitcher>

### Frequently Asked Questions

Users can run into unexpected issues, so we are giving you advance notice in documentation with links to open issues - please vote for what you need, to help the team prioritize.

- `downloadData` is cached; if you have recently modified a file you may not get the latest version right away. You can pass in `cacheControl: 'no-cache'` to get the latest version.
- `downloadData` only returns the latest cached version of the file; there is [not yet an API to view prior versions](https://github.com/aws-amplify/amplify-js/issues/2131).
- [Image compression](https://github.com/aws-amplify/amplify-js/issues/6081) or CloudFront CDN caching for your S3 buckets is not yet possible.
- There is no API for [Cognito Group-based access to files](https://github.com/aws-amplify/amplify-js/issues/3388).
- There is currently [no API for getting the identityId of other users](https://github.com/aws-amplify/amplify-js/issues/5177); you have to retrieve this from elsewhere before calling `Storage.get`.
