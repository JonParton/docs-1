import { getChildPageNodes } from '@/utils/getChildPageNodes';
import { getCustomStaticPath } from '@/utils/getCustomStaticPath';

export const meta = {
  title: 'Customize auth lifecycle',
  description:
    'Learn how to customize the auth lifecycle',
  route: '/[platform]/build-a-backend/auth/customize-auth-lifecycle',
  platforms: [
    // 'android',
    'angular',
    // 'flutter',
    'javascript',
    'nextjs',
    'react',
    'react-native',
    // 'swift',
    'vue'
  ]
};

export function getStaticPaths() {
  return getCustomStaticPath(meta.platforms);
}

export function getStaticProps() {
  const childPageNodes = getChildPageNodes(meta.route);
  return {
    props: {
      meta,
      childPageNodes
    }
  };
}

<Overview childPageNodes={props.childPageNodes} />


Amplify Auth provides sensible defaults for the underlying Amazon Cognito resource definitions. You can customize your authentication resource using `defineAuth` where you can extend the user profile with additional attributes, bucket users into groups, or customize emails with your app's brand.

## User attributes

{/* what standard attributes are */}
To extend a user profile beyond the default `email` or `phone_number` attribute that is automatically configured when specified in your auth resource's `loginWith` property, you can configure attributes with the `userAttributes` property:

```ts title="amplify/auth/resource.ts"
import { defineAuth } from "@aws-amplify/backend"

export const auth = defineAuth({
  loginWith: {
    // this configures a required "email" attribute
    email: true,
  },
  // highlight-start
  userAttributes: {
    // specify a "birthdate" attribute
    birthdate: {
      mutable: true,
      required: false,
    }
  },
  // highlight-end
})
```

User attributes are defined as [Cognito Standard Attributes](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html#cognito-user-pools-standard-attributes). Attributes can be configured to be _required_ for user sign-up in addition to whether the values are _mutable_. When configuring your resource to allow your users to login with `email`, an email must be specified for user sign-up and cannot be changed later. However additional attributes can be configured to be optional, and mutable after sign-up.

<Callout warning>

**Warning**: After you create your auth resource, you cannot switch an attribute between required and not required.

</Callout>

In addition to the provided standard attributes, you can configure [Custom Attributes](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html#user-pool-settings-custom-attributes). These are attributes that are typically unique to your use case, such as a tenant ID. Currently Amplify Auth does not support custom attributes in the `userAttributes` property, however you can [configure your auth resource to accept custom attributes using the AWS Cloud Development Kit (AWS CDK)](/[platform]/build-a-backend/auth/modify-resources-with-cdk/#custom-attributes).

## User groups

Assigning users to groups enable you to customize access for a collection of users, or leverage for auditing purposes. For example, only "ADMINS" users are permitted to delete posts from a bulletin, or only "EDITORS" are permitted to modify posts in a "draft" state. To get started with groups, configure the `groups` property:

```ts title="amplify/auth/resource.ts"
import { defineAuth } from "@aws-amplify/backend"

export const auth = defineAuth({
  loginWith: {
    email: true,
  },
  // highlight-start
  groups: ["ADMINS", "EDITORS"],
  // highlight-end
})
```

<Callout>

**Note:** There are a few [limitations with groups](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-user-groups.html#user-pool-user-groups-limitations), including a limit of 10,000 groups per user pool.

</Callout>

## Customize emails

{/* verification email (basic) */}
{/* verification email with react.email/jsx.email */}

By default, Amplify Auth resources scaffolded by [`create-amplify`](https://www.npmjs.com/package/create-amplify) are configured with email login. When you users sign up they receive a verification email to confirm their ownership of the email they specified during sign-up. Emails such as the verification email can be customized with your app's brand identity.

```ts title="amplify/auth/resource.ts"
import { defineAuth } from "@aws-amplify/backend"

export const auth = defineAuth({
  loginWith: {
    // highlight-start
    email: {
      verificationEmailStyle: "CODE",
      verificationEmailSubject: "Welcome to my app!",
      verificationEmailBody: (createCode) => `Use this code to confirm your account: ${createCode()}`,
    },
    // highlight-end
  },
})
```

## Triggers

Your auth resource's behavior can be customized through the use of triggers. A trigger is defined as a Function, and is a mechanism to slot some logic to execute during the authentication flow. For example, you can use triggers to validate whether emails include an allowlisted domain, add a user to a group upon sign-up, or create a "UserProfile" model upon account confirmation.

Triggers translate to [Cognito user pool Lambda triggers](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html).

> When you have a Lambda trigger assigned to your user pool, Amazon Cognito interrupts its default flow to request information from your function. Amazon Cognito generates a JSON event and passes it to your function. The event contains information about your user's request to create a user account, sign in, reset a password, or update an attribute. Your function then has an opportunity to take action, or to send the event back unmodified.

To learn more about use cases for triggers, visit the [Functions examples](/[platform]/build-a-backend/functions/examples/).
