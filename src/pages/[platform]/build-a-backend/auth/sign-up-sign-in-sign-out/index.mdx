import { getCustomStaticPath } from '@/utils/getCustomStaticPath';

export const meta = {
  title: 'Sign-up, sign-in, and sign-out',
  description:
    'Learn how to use Amplify Auth in your frontend application',
  platforms: [
    // 'android',
    'angular',
    // 'flutter',
    'javascript',
    'nextjs',
    'react',
    // 'react-native',
    // 'swift',
    'vue'
  ]
};

export function getStaticPaths() {
  return getCustomStaticPath(meta.platforms);
}

export function getStaticProps() {
  return {
    props: {
      meta
    }
  };
}

You can add the functionality to enable sign-up, sign-in, and sign-out with the Amplify client libraries. You can connect this to an existing UI or create your own.

{/* We will use the username and password authentication flow to get started. Both [third-party social provider federation](/[platform]/build-a-backend/auth/add-social-provider/) and [Multi-factor authentication](/[platform]/build-a-backend/auth/manage-mfa/) can be added after this initial setup. */}

<InlineFilter filters={["javascript, nextjs, react"]}>

The quickest way to get started with Amplify Auth in your frontend application is with the [Authenticator component](https://ui.docs.amplify.aws/react/connected-components/authenticator).

```tsx title="src/App.tsx"
import { Authenticator } from '@aws-amplify/ui-react';
import { Amplify } from 'aws-amplify';
import '@aws-amplify/ui-react/styles.css';
import outputs from "../amplify_outputs.json";

Amplify.configure(outputs);

export default function App() {
  return (
    <Authenticator>
      {({ signOut, user }) => (
        <main>
          <h1>Hello {user?.username}</h1>
          <button onClick={signOut}>Sign out</button>
        </main>
      )}
    </Authenticator>
  );
}
```

The Authenticator component is automatically configured based on the outputs generated from your backend. To learn more about the Authenticator and how to customize its appearance, visit the [Amplify UI documentation](https://ui.docs.amplify.aws/).

Conversely, you can bring your own UI and leverage the library from [`aws-amplify`](https://www.npmjs.com/package/aws-amplify) to handle authentication flows manually.

</InlineFilter>
<InlineFilter filters={["javascript", "nextjs", "react", "angular", "vue"]}>

## Sign-up

Handle sign-ups with the `signUp` function.

```tsx title="src/App.tsx"
import type { FormEvent } from "react"
import { Amplify } from "aws-amplify"
// highlight-next-line
import { signUp } from "aws-amplify/auth"
import outputs from "../amplify_outputs.json"

Amplify.configure(outputs)

interface SignUpFormElements extends HTMLFormControlsCollection {
  email: HTMLInputElement
  password: HTMLInputElement
}

interface SignUpForm extends HTMLFormElement {
  readonly elements: SignUpFormElements
}

export default function App() {
  async function handleSubmit(event: FormEvent<SignUpForm>) {
    event.preventDefault()
    const form = event.currentTarget
    // ... validate inputs
    await signUp({
      username: form.elements.email.value,
      password: form.elements.password.value,
    })
  }

  return (
    <form onSubmit={handleSubmit}>
      <label htmlFor="email">Email:</label>
      <input type="text" id="email" name="email" />
      <label htmlFor="password">Password:</label>
      <input type="password" id="password" name="password" />
      <input type="submit" />
    </form>
  )
}
```

<Callout info>

**Note:** When specifying `email` or `phone` as a way for your users to sign-in, these are attributes that are used in place of the username. Visit the [concepts page to learn more about usernames](/[platform]/build-a-backend/auth/concepts/#usernames).

</Callout>

The `signUp` API response will include a `nextStep` property, which can be used to determine if further action is required. It may return the following next steps:

- `CONFIRM_SIGN_UP` - The sign up needs to be confirmed by collecting a code from the user and calling `confirmSignUp`.
- `DONE` - The sign up process has been fully completed.
- `COMPLETE_AUTO_SIGN_IN` - The sign up process needs to complete by invoking the `autoSignIn` API.

## Sign-in

Similar to the `signUp` function, use the `signIn` function to sign in.

```tsx title="src/App.tsx"
import type { FormEvent } from "react"
import { Amplify } from "aws-amplify"
// highlight-next-line
import { signIn } from "aws-amplify/auth"
import outputs from "../amplify_outputs.json"

Amplify.configure(outputs)

interface SignInFormElements extends HTMLFormControlsCollection {
  email: HTMLInputElement
  password: HTMLInputElement
}

interface SignInForm extends HTMLFormElement {
  readonly elements: SignInFormElements
}

export default function App() {
  async function handleSubmit(event: FormEvent<SignInForm>) {
    event.preventDefault()
    const form = event.currentTarget
    // ... validate inputs
    await signIn({
      username: form.elements.email.value,
      password: form.elements.password.value,
    })
  }

  return (
    <form onSubmit={handleSubmit}>
      <label htmlFor="email">Email:</label>
      <input type="text" id="email" name="email" />
      <label htmlFor="password">Password:</label>
      <input type="password" id="password" name="password" />
      <input type="submit" />
    </form>
  )
}
```

The `signIn` API response will include a `nextStep` property, which can be used to determine if further action is required. It may return the following next steps:

- `CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED` - The user was created with a temporary password and must set a new one. Complete the process with `confirmSignIn`.
- `CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE` - The sign-in must be confirmed with a custom challenge response. Complete the process with `confirmSignIn`.
- `CONFIRM_SIGN_IN_WITH_TOTP_CODE` - The sign-in must be confirmed with a TOTP code from the user. Complete the process with `confirmSignIn`.
- `CONTINUE_SIGN_IN_WITH_TOTP_SETUP` - The TOTP setup process must be continued. Complete the process with `confirmSignIn`.
- `CONFIRM_SIGN_IN_WITH_SMS_CODE` - The sign-in must be confirmed with a SMS code from the user. Complete the process with `confirmSignIn`.
- `CONTINUE_SIGN_IN_WITH_MFA_SELECTION` - The user must select their mode of MFA verification before signing in. Complete the process with `confirmSignIn`.
- `RESET_PASSWORD` - The user must reset their password via `resetPassword`.
- `CONFIRM_SIGN_UP` - The user hasn't completed the sign-up flow fully and must be confirmed via `confirmSignUp`.
- `DONE` - The sign in process has been completed.

{/* For more information on handling the TOTP and MFA steps that may be returned, please see [_'Multi-factor authentication'_](/[platform]/build-a-backend/auth/manage-mfa/). */}

### Using an external provider

To sign in using an external identity provider such as Google, use the `signInWithRedirect` function.

```tsx title="src/App.tsx"
import { Amplify } from "aws-amplify"
// highlight-next-line
import { signInWithRedirect } from "aws-amplify/auth"
import outputs from "../amplify_outputs.json"

Amplify.configure(outputs)

export default function App() {
  async function handleSignInWithGoogle() {
    signInWithRedirect({ provider: "Google" })
  }

  return (
    <button type="button" onClick={handleSignOut}>
      Sign out
    </button>
  )
}
```

<Callout info>

**Note:** if you do not pass an argument to `signInWithRedirect` it will redirect your users to the [Cognito Hosted UI](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-integration.html), which has limited support for customization.

</Callout>

Alternatively if you have configured OIDC or SAML-based identity providers in your auth resource, you can specify a "custom" provider in `signInWithRedirect`:

```tsx title="src/App.tsx"
import { Amplify } from "aws-amplify"
// highlight-next-line
import { signInWithRedirect } from "aws-amplify/auth"
import outputs from "../amplify_outputs.json"

Amplify.configure(outputs)

export default function App() {
  async function handleSignInWithGoogle() {
    // highlight-next-line
    signInWithRedirect({ provider: {
      // this is the `name` specified for your provider in your backend auth resource
      custom: "MyOidcProvider"
    }})
  }

  return (
    <button type="button" onClick={handleSignInWithGoogle}>
      Sign in with Google
    </button>
  )
}
```

## Sign-out

Sign out using the `signOut` function

```tsx title="src/App.tsx"
import { Amplify } from "aws-amplify"
// highlight-next-line
import { signOut } from "aws-amplify/auth"
import outputs from "../amplify_outputs.json"

Amplify.configure(outputs)

export default function App() {
  async function handleSignOut() {
    await signOut()
  }

  return (
    <button type="button" onClick={handleSignOut}>
      Sign out
    </button>
  )
}
```

You can also sign out users from all devices by performing a global sign-out. This will also invalidate all refresh tokens issued to a user. The user's current access and ID tokens will remain valid on other devices until the refresh token expires (access and ID tokens expire one hour after they are issued).

```tsx title="src/App.tsx"
import { Amplify } from "aws-amplify"
import { signOut } from "aws-amplify/auth"
import outputs from "../amplify_outputs.json"

Amplify.configure(outputs)

export default function App() {
  async function handleSignOut() {
    // highlight-next-line
    await signOut({ global: true })
  }

  return (
    <button type="button" onClick={handleSignOut}>
      // highlight-next-line
      Sign out everywhere
    </button>
  )
}
```

</InlineFilter>

{/* concepts for client-side auth, how does it work? */}
{/* sign-in */}
{/* sign-in (social) */}
{/* sign-out */}
{/* sessions -- how to validate */}
